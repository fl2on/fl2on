name: Actualizar README con URL vÃ¡lida

on:
  schedule:
    - cron: "0 * * * *"
  workflow_dispatch:

jobs:
  update_readme:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: 14

      - name: Check first URL
        id: check_first_url
        run: |
          response=$(curl -s -o /dev/null -w "%{http_code}" "https://metrics.lecoq.io/Raymo111?template=classic&base.header=0&gists=1&lines=1&config.timezone=America%2FToronto")
          if [[ "$response" -eq 200 ]]; then
            echo "URL=https://metrics.lecoq.io/Raymo111?template=classic&base.header=0&gists=1&lines=1&config.timezone=America%2FToronto" >> $GITHUB_ENV
          fi

      - name: Check second URL
        id: check_second_url
        run: |
          response=$(curl -s -o /dev/null -w "%{http_code}" "https://github-readme-activity-graph.cyclic.app/graph?username=qzxtu&bg_color=141320&color=9bcecc&line=ea538d&point=f3d962&area=true&hide_border=true")
          if [[ "$response" -eq 200 ]]; then
            echo "URL=https://github-readme-activity-graph.cyclic.app/graph?username=qzxtu&bg_color=141320&color=9bcecc&line=ea538d&point=f3d962&area=true&hide_border=true" >> $GITHUB_ENV
          fi

      - name: Update README with valid URL
        if: env.URL != ''
        run: |
          url="${{ env.URL }}"
          echo "Using URL: $url"
          sed -i "s|URL_PLACEHOLDER|$url|" README.md
